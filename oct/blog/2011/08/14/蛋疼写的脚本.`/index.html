
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>蛋疼写的脚本.` - 小默的研究中心</title>
  <meta name="author" content="wangxiaomo">

  
  <meta name="description" content="#!/usr/bin/python #-*- coding: utf-8 -*- APP_KEY = "2986120742"
APP_SECRET = "796b90d5a6e3a1cc4d719726f5f99f7d" from weibopy.auth import &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wangxiaomo.github.com/blog/2011/08/14/%E8%9B%8B%E7%96%BC%E5%86%99%E7%9A%84%E8%84%9A%E6%9C%AC.%60/">
  <link href="/oct/favicon.png" rel="icon">
  <link href="/oct/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/oct/javascripts/modernizr-2.0.js"></script>
  <script src="/oct/javascripts/ender.js"></script>
  <script src="/oct/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/blog/atom.xml" rel="alternate" title="小默的研究中心" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/oct/">小默的研究中心</a></h1>
  
    <h2>Perl | PHP | Python...技术宅.微博控</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:wangxiaomo.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/oct/">Blog</a></li>
  <li><a href="/oct/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">蛋疼写的脚本.`</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-14T11:41:00+08:00" pubdate data-updated="true">Aug 14<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><pre lang="python">
#!/usr/bin/python 
#-*- coding: utf-8 -*-
 
APP_KEY = "2986120742"
APP_SECRET = "796b90d5a6e3a1cc4d719726f5f99f7d"

from weibopy.auth import OAuthHandler
from weibopy.api import API
from urlparse import parse_qsl
from getPIN import GetPIN

def get_access_token(username, password):
    auth = OAuthHandler(APP_KEY, APP_SECRET)
    auth_url = auth.get_authorization_url()
    print "Auth URL: ",auth_url
    veri_obj = GetPIN(auth_url, username, password)
    verifier = veri_obj.getPIN()
    print "VERIFIER: ",verifier
    if verifier==-1:
        raise Exception("Error Account")
    token = auth.get_access_token(verifier)
    return dict(parse_qsl(str(token)))


def get_province_id(access_token, uid='', user='' ):
    auth = OAuthHandler(APP_KEY, APP_SECRET)
    auth.setToken(access_token['oauth_token'], access_token['oauth_token_secret'])
    api = API(auth)
    try:
        if uid:
            account = api.get_user(id=uid)
        else:
            account = api.get_user(screen_name=user)
    except:
        return None
    else:
        return account.province

def get_followers_ids(access_token, user):
    auth = OAuthHandler(APP_KEY, APP_SECRET)
    auth.setToken(access_token['oauth_token'], access_token['oauth_token_secret'])
    api = API(auth)
    followers = api.followers_ids(screen_name=user, count=5000)
    return followers.ids

def get_followers(access_token, user):
    auth = OAuthHandler(APP_KEY, APP_SECRET)
    auth.setToken(access_token['oauth_token'], access_token['oauth_token_secret'])
    api = API(auth)
    users = []
    is_first_request = True
    page = 1
    cursor = -1
    count = 200
    while True:
        try:
            followers = api.followers(screen_name=user,cursor=cursor, count=count)
            if len(followers) == 0:
                break
            else:
                print "GOT %d Users" % len(followers)
            users.extend(followers)
            if is_first_request:
                cursor = cursor+1+len(followers)
                is_first_request = False
            else:
                cursor = cursor+len(followers)
            page = page+1
        except:
            break
    return users

province_table = {'34':'安徽','11':'北京','50':'重庆','35':'福建','62':'甘肃','44':'广东',    \
                  '45':'广西','52':'贵州','46':'海南','13':'河北','23':'黑龙江','41':'河南',  \
                  '42':'湖北','43':'湖南','15':'内蒙古','32':'江苏','36':'江西','22':'吉林',  \
                  '21':'辽宁','64':'宁夏','63':'青海','14':'山西','37':'山东','31':'上海',    \
                  '51':'四川','12':'天津','54':'西藏','65':'新疆','53':'云南','33':'浙江',    \
                  '61':'陕西','71':'台湾','81':'香港','82':'澳门','400':'海外','100':'其他'}

def get_province_by_id(province_id):
     return province_table[province_id]

def init_map():
    return {x:0 for x in province_table.keys()}

#token = get_access_token('xxxx','xxxx')
users = get_followers(token, '小默的研究中心')
user_map = init_map()
for user in users:
    user_map[user.province] = user_map[user.province] + 1
user_map = [(user_map[p_id], p_id) for p_id in user_map.keys()]
user_map.sort()
user_map.reverse()
for num,p_id in user_map:
    print "%-11s %-4d" % (get_province_by_id(p_id), num)
</pre>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">wangxiaomo</span></span>

      








  


<time datetime="2011-08-14T11:41:00+08:00" pubdate data-updated="true">Aug 14<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/oct/blog/categories/python/'>Python</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://wangxiaomo.github.com/blog/2011/08/14/%E8%9B%8B%E7%96%BC%E5%86%99%E7%9A%84%E8%84%9A%E6%9C%AC.%60/" data-via="" data-counturl="http://wangxiaomo.github.com/blog/2011/08/14/%E8%9B%8B%E7%96%BC%E5%86%99%E7%9A%84%E8%84%9A%E6%9C%AC.%60/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/oct/blog/2011/08/13/subversion+server%E6%90%AD%E5%BB%BA.%5Bapache2%5D/" title="Previous Post: subversion server搭建.[apache2]">&laquo; subversion server搭建.[apache2]</a>
      
      
        <a class="basic-alignment right" href="/oct/blog/2011/08/17/%E5%85%AD%E5%BA%A6%E5%88%86%E5%89%B2%E7%90%86%E8%AE%BA+%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/" title="Next Post: 六度分割理论 算法分析">六度分割理论 算法分析 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/oct/blog/2012/06/11/emacs+auto-complete+plugins/">emacs auto-complete plugins</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/09/LaTex+CJK+%E5%AD%97%E4%BD%93%E9%97%AE%E9%A2%98%5BLinux%5D/">LaTex CJK 字体问题[Linux]</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/08/nmap+%E4%BD%BF%E7%94%A8./">nmap 使用.</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/07/Arch+PGP+xxx+unknown+%E8%A7%A3%E5%86%B3/">Arch PGP xxx unknown 解决</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/04/Mongo+%E8%81%9A%E5%90%88/">Mongo 聚合</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - wangxiaomo -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
