
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>小默的研究中心</title>
  <meta name="author" content="wangxiaomo">

  
  <meta name="description" content="Android Thread 退出的时候遇到了问题.无法 destory. 最后搜索到一个比较靠谱的文章. 说可以通过设置一个布尔变量来把 Thread 函数 return 掉就可以了. class RingThread extends Thread { MediaPlayer mPlayer; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wangxiaomo.github.com/blog/page/2/">
  <link href="/oct/favicon.png" rel="icon">
  <link href="/oct/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/oct/javascripts/modernizr-2.0.js"></script>
  <script src="/oct/javascripts/ender.js"></script>
  <script src="/oct/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/blog/atom.xml" rel="alternate" title="小默的研究中心" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/oct/">小默的研究中心</a></h1>
  
    <h2>Perl | PHP | Python...技术宅.微博控</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:wangxiaomo.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/oct/">Blog</a></li>
  <li><a href="/oct/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/04/18/Android+Thread+%E9%80%80%E5%87%BA%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98./">Android Thread 退出错误问题.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-18T08:42:00+08:00" pubdate data-updated="true">Apr 18<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Android Thread 退出的时候遇到了问题.无法 destory. 最后搜索到一个比较靠谱的文章. 说可以通过设置一个布尔变量来把 Thread 函数 return 掉就可以了.</p>

<pre lang="java">
class RingThread extends Thread {
    MediaPlayer mPlayer;
    Context mContext;
    boolean flag;
    
    public RingThread(Context context){
      mPlayer = new MediaPlayer();
      mContext = context;
      flag = false;
    }
    
    @Override
    public void run(){
      Uri alert = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_ALARM);
      try {

        mPlayer.setDataSource(mContext, alert);
        final AudioManager audioManager = (AudioManager) getSystemService(Context.AUDIO_SERVICE);
        if (audioManager.getStreamVolume(AudioManager.STREAM_ALARM) != 0) {
            mPlayer.setAudioStreamType(AudioManager.STREAM_ALARM);          
            if(mPlayer.isPlaying()){
              mPlayer.stop();
              mPlayer.reset();
            }
            mPlayer.setLooping(true);
            mPlayer.prepare();
            mPlayer.start();
        }
      } catch (IllegalStateException e) {
        e.printStackTrace();
      } catch (IOException e) {
        e.printStackTrace();
      }
      if(flag){
        return;
      }
    }
    
    public void stop_ringing(){
      mPlayer.stop();
      flag = true;
    }
  }
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/04/01/%5BDataTypes%5DBinSearchTree/">[DataTypes]BinSearchTree</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-01T07:23:00+08:00" pubdate data-updated="true">Apr 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>BinSearchTree.pm</p>

<pre lang="perl">
package BinSearchTree;
use warnings;
use strict;

package TreeNode;
sub new {
    my $class = shift;
    my $self  = {
        KEY     =>  0,
        LEFT    =>  undef,
        RIGHT   =>  undef,
    };
    bless $self, $class;
}

package Tree;
sub new {
    my $class = shift;
    my $self  = {
        NODENUMS    =>  0,
        ROOT        =>  undef,
    };
    bless $self, $class;
}
sub _add {
    my $self = shift;
    my $node = shift;
    if ($self->{NODENUMS} == 0) {
        $self->{ROOT} = $node;
    } else {
        my $root = $self->{ROOT};
        my $key  = $node->{KEY};
        my $walk; $walk = sub {
            my $node = shift;
            if ($key >= $node->{KEY}) {
                return $node unless defined($node->{RIGHT});
                $walk->($node->{RIGHT});
            } else {
                return $node unless defined($node->{LEFT});
                $walk->($node->{LEFT});
            }
        };

        my $target = $walk->($root);
        if ($key >= $target->{KEY}) {
            $target->{RIGHT}  = $node;
        } else {
            $target->{LEFT} = $node;
        }
    }
    $self->{NODENUMS} += 1;
}

sub add {
    my $self = shift;
    foreach my $node (@_) {
        $self->_add($node);
    }
}

sub _LVR {
    my $node = shift;
    my $func = shift;
    _LVR($node->{LEFT},  $func) if defined $node->{LEFT};
    $func->($node);
    _LVR($node->{RIGHT}, $func) if defined $node->{RIGHT};
}

sub do_LVR {
    my $self = shift;
    return if $self->{NODENUMS} == 0;
    my $func = shift;
    _LVR($self->{ROOT}, $func);
}

1;

__END__
package main;
my $tree = Tree->new;
my $nodeA = TreeNode->new;
$nodeA->{KEY} = 2;
my $nodeB = TreeNode->new;
$nodeB->{KEY} = 1;
my $nodeC = TreeNode->new;
$nodeC->{KEY} = 3;
$tree->add($nodeA,$nodeB,$nodeC);

use Smart::Comments;
### $tree
my $f = sub { my $node = shift; print $node->{KEY}, "\n"; };
$tree->do_LVR($f);
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/04/01/%5BDataTypes%5DHeap/">[DataTypes]Heap</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-01T07:22:00+08:00" pubdate data-updated="true">Apr 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Heap.pm</p>

<pre lang="perl">
package Heap;
use warnings;
use strict 'vars';

package DataNode;
sub new {
    my $class = shift;
    my $self  = {
        KEY     =>  0,
    };
    bless $self, $class;
}

package Heap;
sub new {
    my $class = shift;
    my $self  = {
        FLAG    =>  '>',
        DATA    =>  [0,],
    };
    bless $self, $class;
}

sub _add {
    my $self = shift;
    my $data = shift;
    if ($self->{DATA}->[0] == 0) {
        push @{$self->{DATA}}, $data;
    } else {
        my $size   = $self->{DATA}->[0];
        my $op     = $self->{FLAG};
        my $i      = $size+1;
        my $father = int($i/2);
        my $check  = sub {
            my ($a, $b) = @_;
            if ($op eq '>') {
                return $a>$b;
            } else {
                return $a<$b;
            }
        };

        while ($father and $check->($data->{KEY}, $self->{DATA}->[$father])){
            $self->{DATA}->[$i] = $self->{DATA}->[$father];
            $i      = int($i/2);
            $father = int($i/2);
        }
        $self->{DATA}->[$i] = $data;
    }       
    $self->{DATA}->[0] += 1;
}

sub push {
    my $self = shift;
    foreach my $data (@_) {
        $self->_add($data);
    }
}

sub pop {
    my $self = shift;
    return $self->{DATA}->[0]
        if $self->{DATA}->[0] == 0;
    
    my $node = $self->{DATA}->[1];
    $self->{DATA}->[0] -= 1;

    my $size = $self->{DATA}->[0];
    my $last = pop @{$self->{DATA}};
    $self->_add($last);

    return $node;   
}

1;
__END__
package main;
my $heap  = Heap->new;
$heap->{FLAG} = '<';
my $dataA = DataNode->new;
$dataA->{KEY} = 5;
my $dataB = DataNode->new;
$dataB->{KEY} = 3;

$heap->push($dataA,$dataB);
print $heap->{DATA}->[0],"\n";
print $heap->{DATA}->[1]->{KEY},"\n";
print $heap->{DATA}->[2]->{KEY},"\n";

my $node = $heap->pop;
print $node->{KEY}, "\n";
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/03/31/%5BDataTypes%5DThreadBinTree/">[DataTypes]ThreadBinTree</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-31T06:47:00+08:00" pubdate data-updated="true">Mar 31<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ThreadBinTree.pm</p>

<pre lang="perl">
package ThreadBinTree;
use warnings;
use strict 'vars';

package TreeNode;
sub new {
    my $class = shift;
    my $self  = {
        DATA    =>  {},
        LTHREAD =>  0,
        RTHREAD =>  0,
        LEFT    =>  undef,
        RIGHT   =>  undef,
    };
    bless $self, $class;
}

package Tree;
sub new {
    my $class = shift;
    my $self  = {
        ROOT    =>  TreeNode->new,
        NODENUMS=>  0,
    };
    bless $self, $class;
}

sub _LVR {
    my $node = shift;
    my $func = shift;
    _LVR($node->{LEFT},  $func) if defined($node->{LEFT});
    $func->($node);
    _LVR($node->{RIGHT}, $func) if defined($node->{RIGHT});
}

sub pretreat {
    my $self = shift;
    return if $self->{NODENUMS} == 0;

    use Queue;
    my $queue     = Queue->new;
    my $root      = $self->{ROOT};
    my $node      = $root->{LEFT};
    my $mark      = sub {
        my $node = shift;
        $queue->add($node);
    };
    _LVR($node, $mark);
    my $nodes = [];
    while($queue->size){
        push @$nodes, $queue->get;
    }
    my $size = scalar @$nodes;
    unshift @$nodes, $root;
    push    @$nodes, $root;
    foreach my $i (1 .. $size){
        if (not defined($nodes->[$i]->{LEFT})) {
            $nodes->[$i]->{LTHREAD} = 1;
            $nodes->[$i]->{LEFT}    = $nodes->[$i-1];
        }
        if (not defined($nodes->[$i]->{RIGHT})) {
            $nodes->[$i]->{RTHREAD} = 1;
            $nodes->[$i]->{RIGHT}   = $nodes->[$i+1];
        }
    }
}   

sub view {
    my ($self, $func) = @_;
    return if $self->{NODENUMS} == 0;
    use Queue;
    my $queue = Queue->new;

    my $root = $self->{ROOT};
    my $walk = sub {
        my $node = shift;
        while($node->{LTHREAD} == 0){
            $node = $node->{LEFT};
        }
        return $node;
    }; 
    
    my $node = $walk->($root->{LEFT});
    $queue->add($node);
    my $next = $node->{RIGHT};
    while($next != $root){
        $queue->add($next);
        $next = $next->{RIGHT};
    }
    
    # thread view inorder
    while($queue->size){
        my $node = $queue->get;
        $func->($node);
    }
}

1;

__END__
package main;
my $nodeA = TreeNode->new;
$nodeA->{DATA}->{data} = "i'm nodeA!";
my $nodeB = TreeNode->new;
$nodeB->{DATA}->{data} = "i'm nodeB!";
my $nodeC = TreeNode->new;
$nodeC->{DATA}->{data} = "i'm nodeC!";

$nodeA->{LEFT}    = $nodeB;
$nodeA->{RIGHT}   = $nodeC;

my $tree = Tree->new;
$tree->{NODENUMS} = 3;
$tree->{ROOT}->{LEFT} = $nodeA;

=comment

$nodeB->{LTHREAD} = 1;
$nodeB->{LEFT}    = $tree->{ROOT};
$nodeB->{RTHREAD} = 1;
$nodeB->{RIGHT}   = $nodeA;
$nodeC->{LTHREAD} = 1;
$nodeC->{LEFT}    = $nodeA;
$nodeC->{RTHREAD} = 1;
$nodeC->{RIGHT}   = $tree->{ROOT};

=cut

my $f = sub {
    my $node = shift;
    print $node->{DATA}->{data}, "\n";
};
$tree->pretreat;
$tree->view($f);

__END__
线索二叉树为了方便加入一个空的头结点。
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/03/31/%5BDataTypes%5DBinTree/">[DataTypes]BinTree</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-31T06:47:00+08:00" pubdate data-updated="true">Mar 31<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>BinTree.pm</p>

<pre lang="perl">
package BinTree;
use warnings;
use strict 'vars';

package Helper;
sub METHOD {
    my $param  = shift;
    my $method = {
        LEVEL_VIEW  =>  \&LEVEL_VIEW,
        LVR         =>  \&LVR,
        VLR         =>  \&VLR,
        LRV         =>  \&LRV,
    };
    return $method->{$param};
}

sub LEVEL_VIEW {
    my ($node, $func) = @_;
    use Queue;
    my $queue = Queue->new;
    my $add_node_to_queue; $add_node_to_queue = sub {
        my $node = shift;
        $queue->add($node);
        $add_node_to_queue->($node->{LEFT})  if defined($node->{LEFT});
        $add_node_to_queue->($node->{RIGHT}) if defined($node->{RIGHT});
    };

    $add_node_to_queue->($node);
    while ($queue->size) {
        my $node = $queue->get;
        $func->($node);
    }
}

sub LVR {
    my ($node, $func) = @_;
    LVR($node->{LEFT}, $func) if defined($node->{LEFT});
    $func->($node);
    LVR($node->{RIGHT}, $func) if defined($node->{RIGHT});
}
sub VLR {
    my ($node, $func) = @_;
    $func->($node);
    VLR($node->{LEFT}, $func) if defined($node->{LEFT});
    VLR($node->{RIGHT}, $func) if defined($node->{RIGHT});
}
sub LRV {
    my ($node, $func) = @_;
    LRV($node->{LEFT}, $func) if defined($node->{LEFT});
    LRV($node->{RIGHT}, $func) if defined($node->{RIGHT});
    $func->($node);
}

package TreeNode;
sub new {
    my $class = shift;
    my $self  = {
        DATA    =>  {},
        LEFT    =>  undef,
        RIGHT   =>  undef,
    };
    bless $self, $class;
}

package Tree;
sub new {
    my $class = shift;
    my $self  = {
        NODENUMS    =>  0,
        ROOT        =>  undef,
    };
    bless $self, $class;
}

sub get_nodes_num {
    my $self = shift;
    return $self->{NODENUMS};
}

sub get_root {
    my $self = shift;
    return $self->{ROOT};
}

sub do_LVR {
    my $self = shift;
    my $func = shift;
    return if $self->{NODENUMS} == 0;
    my $root = $self->{ROOT};
    Helper::LVR($root, $func);
}

sub do_recursion_view {
    my ($self, $recursion_method, $func) = @_;
    ### $recursion_method
    return if $self->{NODENUMS} == 0;
    $recursion_method->($self->{ROOT}, $func);
}

1;

__END__
package main;
my $nodeA = TreeNode->new;
$nodeA->{DATA}->{'data'} = "i'm node A";
my $nodeB = TreeNode->new;
$nodeB->{DATA}->{'data'} = "i'm node B";
my $nodeC = TreeNode->new;
$nodeC->{DATA}->{'data'} = "i'm node C";
$nodeA->{LEFT}  = $nodeB;
$nodeA->{RIGHT} = $nodeC;

my $tree = Tree->new;
$tree->{NODENUMS} = 3;
$tree->{ROOT}     = $nodeA;

use Smart::Comments;
### $tree

my $f = sub {
    my $node = shift;
    print $node->{DATA}->{data}, "\n";
};
$tree->do_LVR($f);
$tree->do_recursion_view(
    Helper::METHOD("LVR"),
    $f
);
Helper::METHOD("LEVEL_VIEW")->($tree->{ROOT}, $f);
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/03/31/%5BDataTypes%5DStack+and+Queue/">[DataTypes]Stack and Queue</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-31T06:46:00+08:00" pubdate data-updated="true">Mar 31<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Stack.pm</p>

<pre lang="perl">
package Stack;
use warnings;
use strict 'vars';

sub new {
    my $class = shift;
    my $self  = [];
    bless $self, $class;
}

sub stack_push {
    my $self = shift;
    push @$self, @_;
}

sub stack_pop {
    my $self = shift;
    pop @$self;
}

sub size {
    my $self = shift;
    scalar @$self;
}

1;

__END__

package main;
my $s = Stack->new;
$s->stack_push(1, 2, 3, 4, 5);

while(1){
    last unless $s->size;
    my $elem = $s->stack_pop;
    print $elem, "\n";
}
</pre>


<p>Queue.pm</p>

<pre lang="perl">
package Queue;
use warnings;
use strict 'vars';

sub new {
    my $class = shift;
    my $self  = [];
    bless $self, $class;
}

sub add {
    my $self = shift;
    push @$self, @_;
}

sub get {
    my $self = shift;
    shift @$self;
}

sub size {
    my $self = shift;
    scalar @$self;
}

1;

__END__

package main;
my $q = Queue->new;
$q->add(1,2,3,4,5);

while(1){
    last unless $q->size;
    my $elem = $q->get;
    print $elem, "\n";
}
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/03/30/linux+%E5%90%84%E7%A7%8D+gui+%E7%BE%8E%E5%8C%96%E6%96%B9%E6%B3%95/">Linux 各种 Gui 美化方法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-30T04:54:00+08:00" pubdate data-updated="true">Mar 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>linux 下 gui 无非就是 qt 或 gtk. 其他的不常见就不考虑美化的问题。
qt 美化的需要安装：</p>

<pre lang="bash">
aptitude install qt3-qtconfig qt4-qtconfig
</pre>


<p>然后通过</p>

<pre lang="bash">
qtconfig-qt3
qtconfig-qt4
</pre>


<p>来设置 qt style.
gtk 美化的需要安装：</p>

<pre lang="bash">
aptitude install gtk-chtheme
</pre>


<p>然后通过</p>

<pre lang="bash">
gtk-chtheme
</pre>


<p>来设置。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/03/30/tint2+%E9%85%8D%E7%BD%AE/">Tint2 配置</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-30T03:57:00+08:00" pubdate data-updated="true">Mar 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>昨天 12.04 崩溃了。幸亏做了备份。今天恢复的进度也挺快的。。
下面写下自己的 tint2 配置文件</p>

<pre lang="bash">
# Tint2 config file
# Generated by tintwizard (http://code.google.com/p/tintwizard/)
# For information on manually configuring tint2 see http://code.google.com/p/tint2/wiki/Configure

# Background definitions
# ID 1
rounded = 7
border_width = 2
background_color = #000000 60
border_color = #FFFFFF 16

# ID 2
rounded = 5
border_width = 0
background_color = #FFFFFF 40
border_color = #FFFFFF 48

# ID 3
rounded = 5
border_width = 0
background_color = #FFFFFF 16
border_color = #FFFFFF 68

# Panel
panel_monitor = all
panel_position = bottom center horizontal
panel_size = 95% 40
panel_margin = 5 5
panel_padding = 7 0 7
panel_dock = 0
wm_menu = 1
panel_layer = top
panel_background_id = 1

# Panel Autohide
autohide = 0
autohide_show_timeout = 0.3
autohide_hide_timeout = 2
autohide_height = 2
strut_policy = follow_size

# Taskbar
taskbar_mode = single_desktop
#taskbar_mode = multi_desktop
taskbar_padding = 2 3 2
taskbar_background_id = 0
taskbar_active_background_id = 0

# Tasks
urgent_nb_of_blink = 8
task_icon = 1
task_text = 1
task_centered = 1
task_maximum_size = 240 35
task_padding = 6 2
task_background_id = 3
task_active_background_id = 2
task_urgent_background_id = 2
task_iconified_background_id = 3
task_tooltip = 0

# Task Icons
task_icon_asb = 70 0 0
task_active_icon_asb = 100 0 0
task_urgent_icon_asb = 100 0 0
task_iconified_icon_asb = 70 0 0

# Fonts
task_font = sans 7
task_font_color = #FFFFFF 68
task_active_font_color = #FFFFFF 83
task_urgent_font_color = #FFFFFF 83
task_iconified_font_color = #FFFFFF 68
font_shadow = 0

# System Tray
systray = 1
systray_padding = 0 4 5
systray_sort = ascending
systray_background_id = 0
systray_icon_size = 16
systray_icon_asb = 70 0 0

# Clock
time1_format = %H:%M
time1_font = sans 8
time2_format = %A %d %B
time2_font = sans 6
clock_font_color = #FFFFFF 74
clock_padding = 1 0
clock_background_id = 0
clock_rclick_command = orage

# Tooltips
tooltip_padding = 2 2
tooltip_show_timeout = 0.7
tooltip_hide_timeout = 0.3
tooltip_background_id = 1
tooltip_font = sans 10
tooltip_font_color = #000000 80

# Mouse
mouse_middle = none
mouse_right = close
mouse_scroll_up = toggle
mouse_scroll_down = iconify

# Battery
battery = 1
battery_low_status = 10
battery_low_cmd = notify-send "battery low"
battery_hide = 98
bat1_font = sans 8
bat2_font = sans 6
battery_font_color = #FFFFFF 74
battery_padding = 1 0
battery_background_id = 0

# End of config
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/03/11/Pod%3A%3ASimple%3A%3AWikiBatch+%E9%A2%9D%E3%80%82%E5%81%87%E6%83%B3%E5%8C%85/">Pod::Simple::WikiBatch 额。假想包</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-11T10:34:00+08:00" pubdate data-updated="true">Mar 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天抽风想把自己之前翻译或者代码中所写的 pod 全部上传到 readthedocs 上去. 结果纠结了一下午都没搞定。恩。其实也不能怪我，readthedocs 连个 manual book 都没有，我怎么能知道怎么用啊。
首先。我以为它可以从 github 中自己构建文档，恩。我错了。 pod 是无法直接转成 sphinx 的。然后有个选项说是上传 html zip 文件上去，那我就开始找 Pod 2 HTML 批量转化的模块。找到一个 Pod::Simple::HTMLBatch，使用起来还是比较方便的。压缩上传后还是不行。然后我就开始仔细研究这个 sphinx。后来发现这个是 python 的一个模块，用来方便构建 python 文档。我就郁闷了。然后我就继续查移植性的东西，未果。
既然都弄了这么半天了，我就搜索下转成 wiki 页面放在 SAE 上吧。继续 cpan 搜索 wiki 模块，结果没有找到批量转化的模块。所以就自己写了一个。应该可以申请 Pod::Simple::WikiBatch。
最终的页面虽然简介丑陋，不过我觉得够用了。以后再优化吧。今天不在状态，递归老想歪。哎。。
上代码。</p>

<pre lang="perl">
#!/usr/bin/perl
use warnings;
use strict 'vars';
use vars qw/%opt $title $index $trees $in $out/;

#use Smart::Comments;
use Carp qw/croak/;
use File::Basename;

#-----------------------------------------------------

sub build_wiki_file {
    my $pod  = shift;
    my ($name, $dir) = fileparse($pod);

    my $wiki     = $out . substr($dir, length($in)) . $name;
    my $wiki_dir = dirname $wiki;
    my $cmd  = "mkdir -p $wiki_dir && pod2text $pod $wiki";
    `$cmd`;
}

sub build_wiki {
    my $root  = shift;
    my @stack = ();
    ### @stack
    opendir IN, $root or croak;
    my @dirs = map { $root . "/" . $_ } 
                 grep { $_ ne "." and $_ ne ".." } readdir IN;
    ### @dirs
    foreach my $file (@dirs) {
        ### FILE: $file
        if (-d $file) {
            unshift @stack, build_wiki($file);
        } elsif (-f $file) {
            next if $file =~ /(pm|pod|pl)^/;
            unshift @stack, $file;
            build_wiki_file($file);
        } else {
            warn "$file is not a standard pod file\n";
        }
    }
    return \@stack;
}

sub writer {
    my ($data, $file) = @_;
    open OUT, ">", $file;
    print OUT $data;
}

sub make_index_html {
    my $html = <<HTML;
<html>
<head>
<title>$title</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<frameset cols="25%,75%">
    <frame src="left.html" />
    <frame name="main" src="$index" />
</frameset>
</html>
HTML
    $html    = eval { $html };
    ### $html
    my $file = "$out/index.html";
    writer $html, $file; 
}

sub get_sider_html {
    my $items = shift;
    my $html  = "<ul>";
    ### @$trees
    foreach my $item (@$items) {
        if (ref $item) {
            # 提取出该级目录名
            my $item_name = basename($item->[0]);
            $item->[0] =~ /(?:.*)\/(.*)\/$item_name/;
            $html = $html . "<li><a>$1</a>"; 
            $html = $html . get_sider_html($item);
            $html = $html . "</li>";
        } else {
            $item = substr $item, length($in)+1;
            $html = $html . "<li><a href=\"$item\" target=\"main\">$item</a></li>";
        }
    }
    $html .= "</ul>";
    return $html;
}

sub make_sider_html {
    my $html = get_sider_html($trees);
    my $file = "$out/left.html";
    writer $html, $file;
}

#-------------------------------------------------------

use Getopt::Std;
getopts('i:t:', \%opt);
### %opt
($title, $index) = ("WiKi", "default.html");
$title = $opt{t} if defined $opt{t};
$index = $opt{i} if defined $opt{i};
($in, $out)      = map { basename $_ } @ARGV;

$trees  = build_wiki($in);
make_index_html();
make_sider_html();
</pre>


<p>另外。
moose_cn 项目： <a href="http://moosecn.sinaapp.com">http://moosecn.sinaapp.com</a>
perltut 项目：<a href="http://perltut.sinaapp.com">http://perltut.sinaapp.com</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2012/03/11/ubuntu+%E5%AE%89%E8%A3%85+deepin-software-center/">Ubuntu 安装 Deepin-software-center</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-11T06:25:00+08:00" pubdate data-updated="true">Mar 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><pre lang="bash">
apt-get install aria2
git clone git://github.com/manateelazycat/deepin-software-center.git
cd deepin-software-center/src/ && ./main
</pre>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/oct/blog/page/3/">&larr; Older</a>
    
    <a href="/oct/blog/archives">Blog Archives</a>
    
    <a class="next" href="/oct/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/oct/blog/2012/06/11/emacs+auto-complete+plugins/">emacs auto-complete plugins</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/09/LaTex+CJK+%E5%AD%97%E4%BD%93%E9%97%AE%E9%A2%98%5BLinux%5D/">LaTex CJK 字体问题[Linux]</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/08/nmap+%E4%BD%BF%E7%94%A8./">nmap 使用.</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/07/Arch+PGP+xxx+unknown+%E8%A7%A3%E5%86%B3/">Arch PGP xxx unknown 解决</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/04/Mongo+%E8%81%9A%E5%90%88/">Mongo 聚合</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - wangxiaomo -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
